# AstralEmu - Target device definitions
#
# Each device defines the hardware target for cross-compilation.
# The build matrix iterates over all devices listed here.
#
# To add a new device:
#   1. Add an entry below with a unique id
#   2. Commit and push — the CI will automatically build all emulators for it
#
# Fields:
#   id         — Short identifier used in package names (e.g. azahar-emu-<id>)
#                Also used as prefix for mirrored dependency packages (e.g. l4t-libfoo)
#   name       — Human-readable device name
#   arch       — Debian architecture (arm64, amd64)
#   platform   — Docker platform string
#   base_image — Docker base image for the build container
#   source_distro — Distro codename matching the base_image (for dep resolution)
#   runner     — GitHub Actions runner type (ubuntu-24.04-arm for arm64, ubuntu-24.04 for amd64)
#   cflags     — C compiler flags (arch targeting + optimizations, WITHOUT LTO)
#   cxxflags   — C++ compiler flags (usually same as cflags, WITHOUT LTO)
#   power      — Device power score (1-5), used to filter emulators too heavy for this device
#                Scores account for AstralEmu's 40-60% performance boost over stock distro packages
#   sources    — List of package sources to mirror for this device (optional)
#
# Source fields:
#   id         — Unique source identifier
#   name       — Human-readable description
#   type       — Source type: git-repo, url
#   url        — URL to clone or fetch from
#   format     — Package format at source: deb, rpm, pacman
#
# Note: LTO and jemalloc are added by the workflow, not here.
#   clang builds → -flto=thin    (azahar, duckstation)
#   gcc builds   → -flto         (dolphin, melonds, ppsspp, esde, xemu, libretro)
#   All builds   → -ljemalloc    (hardcoded in workflow)

devices:
  - id: l4t
    name: "Nintendo Switch (Tegra X1)"
    arch: arm64
    power: 4
    platform: linux/arm64
    runner: ubuntu-24.04-arm
    base_image: ubuntu:24.04
    source_distro: noble
    cflags: "-O3 -march=armv8-a+crc+simd -mtune=cortex-a57"
    cxxflags: "-O3 -march=armv8-a+crc+simd -mtune=cortex-a57"
    sources:
      - id: l4t-debs
        name: "L4T kernel and driver packages"
        type: git-repo
        url: https://github.com/theofficialgman/l4t-debs.git
        format: deb

  - id: rpi4
    name: "Raspberry Pi 4 (Cortex-A72)"
    arch: arm64
    power: 3
    platform: linux/arm64
    runner: ubuntu-24.04-arm
    base_image: ubuntu:24.04
    source_distro: noble
    cflags: "-O3 -march=armv8-a+crc+simd -mtune=cortex-a72"
    cxxflags: "-O3 -march=armv8-a+crc+simd -mtune=cortex-a72"

  - id: armv8-2
    name: "ARMv8.2-A (Raspberry Pi 5 / RK3588 / Snapdragon 845-888)"
    arch: arm64
    power: 5
    platform: linux/arm64
    runner: ubuntu-24.04-arm
    base_image: ubuntu:24.04
    source_distro: noble
    cflags: "-O3 -march=armv8.2-a+crypto+fp16+rcpc+dotprod -mtune=cortex-a76"
    cxxflags: "-O3 -march=armv8.2-a+crypto+fp16+rcpc+dotprod -mtune=cortex-a76"

  - id: armv9
    name: "ARMv9.0-A (Snapdragon 8 Gen 1/2/3, Cortex-X2+)"
    arch: arm64
    power: 5
    platform: linux/arm64
    runner: ubuntu-24.04-arm
    base_image: ubuntu:24.04
    source_distro: noble
    cflags: "-O3 -march=armv9-a+crypto -mtune=cortex-x2"
    cxxflags: "-O3 -march=armv9-a+crypto -mtune=cortex-x2"

  - id: x86-v2
    name: "x86-64-v2 (Intel Sandy Bridge+ / AMD Bulldozer+)"
    arch: amd64
    power: 4
    platform: linux/amd64
    runner: ubuntu-24.04
    base_image: ubuntu:24.04
    source_distro: noble
    cflags: "-O3 -march=x86-64-v2"
    cxxflags: "-O3 -march=x86-64-v2"

  - id: x86-v3
    name: "x86-64-v3 (Intel Haswell+ / AMD Ryzen / Steam Deck)"
    arch: amd64
    power: 5
    platform: linux/amd64
    runner: ubuntu-24.04
    base_image: ubuntu:24.04
    source_distro: noble
    cflags: "-O3 -march=x86-64-v3"
    cxxflags: "-O3 -march=x86-64-v3"

  - id: x86-v4
    name: "x86-64-v4 (Intel Ice Lake-SP+ / AMD Zen 4+)"
    arch: amd64
    power: 5
    platform: linux/amd64
    runner: ubuntu-24.04
    base_image: ubuntu:24.04
    source_distro: noble
    cflags: "-O3 -march=x86-64-v4"
    cxxflags: "-O3 -march=x86-64-v4"
